{% extends "admin/base.html" %}

{% block title %}{{ journalist.name }}{% endblock %}
{% block header %}{{ journalist.name }}{% endblock %}
{% block subheader %}{% if current_lang == 'fr' %}D√©tails et gestion du journaliste{% else %}Journalist details and management{% endif %}{% endblock %}

{% block content %}
<div class="flex gap-4 mb-6">
    <a href="{{ url_for('journalists.index') }}" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition">
        <i class="fas fa-arrow-left mr-2"></i>{{ _('back') }}
    </a>
    <a href="{{ url_for('journalists.edit', id=journalist.id) }}" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition">
        <i class="fas fa-edit mr-2"></i>{{ _('edit') }}
    </a>
    <button onclick="fetchSources()" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-xl hover:bg-blue-200 transition">
        <i class="fas fa-sync mr-2"></i>{{ _('fetch_articles') }}
    </button>
    <button onclick="generateSummaryText()" class="px-4 py-2 bg-green-100 text-green-700 rounded-xl hover:bg-green-200 transition">
        <i class="fas fa-file-alt mr-2"></i>{% if current_lang == 'fr' %}G√©n√©rer r√©sum√© texte{% else %}Generate text summary{% endif %}
    </button>
    <button onclick="generateSummaryAudio()" class="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl hover:bg-purple-200 transition">
        <i class="fas fa-volume-up mr-2"></i>{% if current_lang == 'fr' %}G√©n√©rer r√©sum√© audio{% else %}Generate audio summary{% endif %}
    </button>
</div>

<div class="grid lg:grid-cols-3 gap-6">
    <div class="lg:col-span-1 space-y-6">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex items-center gap-4 mb-6">
                {% if journalist.photo_url %}
                    <img src="{{ journalist.photo_url }}" alt="{{ journalist.name }}" class="w-16 h-16 rounded-2xl object-cover">
                {% else %}
                    <div class="w-16 h-16 rounded-2xl bg-primary-100 flex items-center justify-center">
                        <i class="fas fa-robot text-3xl text-primary-600"></i>
                    </div>
                {% endif %}
                <div>
                    <h3 class="text-xl font-semibold text-gray-800">{{ journalist.name }}</h3>
                    <span class="px-3 py-1 rounded-full text-xs {% if journalist.is_active %}bg-green-100 text-green-600{% else %}bg-gray-100 text-gray-600{% endif %}">
                        {{ _('active') if journalist.is_active else _('inactive') }}
                    </span>
                </div>
            </div>
            
            <div class="space-y-4 text-sm">
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-gray-500">{{ _('language') }}</span>
                    <span class="font-medium">{{ journalist.language|upper }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-gray-500">{% if current_lang == 'fr' %}Ton{% else %}Tone{% endif %}</span>
                    <span class="font-medium">{{ journalist.tone }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-gray-500">{% if current_lang == 'fr' %}Style{% else %}Style{% endif %}</span>
                    <span class="font-medium">{{ journalist.spelling_style }}</span>
                </div>
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-gray-500">{% if current_lang == 'fr' %}Heure r√©sum√©{% else %}Summary time{% endif %}</span>
                    <span class="font-medium">{{ journalist.summary_time }}</span>
                </div>
                <div class="flex justify-between py-2">
                    <span class="text-gray-500">{% if current_lang == 'fr' %}Cr√©√© le{% else %}Created{% endif %}</span>
                    <span class="font-medium">{{ format_datetime(journalist.created_at) }}</span>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h4 class="font-semibold text-gray-800 mb-2">{% if current_lang == 'fr' %}Personnalit√©{% else %}Personality{% endif %}</h4>
            <p class="text-sm text-gray-600">{{ journalist.personality }}</p>
        </div>
        
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h4 class="font-semibold text-gray-800 mb-2">{% if current_lang == 'fr' %}Style d'√©criture{% else %}Writing Style{% endif %}</h4>
            <p class="text-sm text-gray-600">{{ journalist.writing_style }}</p>
        </div>
    </div>
    
    <div class="lg:col-span-2 space-y-6">
        <!-- Statistics Section -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}Derni√®re r√©cup√©ration{% else %}Last fetch{% endif %}</p>
                {% if stats.last_fetch_time %}
                    <p class="text-lg font-bold text-gray-800">{{ stats.last_fetch_time.strftime('%H:%M') }}</p>
                    <p class="text-xs text-gray-400">{{ stats.last_fetch_time.strftime('%d/%m') }}</p>
                {% else %}
                    <p class="text-lg font-bold text-gray-400">-</p>
                {% endif %}
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}Dernier r√©sum√©{% else %}Last summary{% endif %}</p>
                {% if stats.last_summary_created %}
                    <p class="text-lg font-bold text-gray-800">{{ stats.last_summary_created.strftime('%H:%M') }}</p>
                    <p class="text-xs text-gray-400">{{ stats.last_summary_created.strftime('%d/%m') }}</p>
                {% else %}
                    <p class="text-lg font-bold text-gray-400">-</p>
                {% endif %}
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}Dernier envoi{% else %}Last send{% endif %}</p>
                {% if stats.last_summary_sent %}
                    <p class="text-lg font-bold text-gray-800">{{ stats.last_summary_sent.strftime('%H:%M') }}</p>
                    <p class="text-xs text-gray-400">{{ stats.last_summary_sent.strftime('%d/%m') }}</p>
                {% else %}
                    <p class="text-lg font-bold text-gray-400">-</p>
                {% endif %}
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}Heure actuelle{% else %}Current time{% endif %}</p>
                <p class="text-lg font-bold text-gray-800">{{ stats.now_local.strftime('%H:%M') }}</p>
                <p class="text-xs text-gray-400">{{ stats.timezone }}</p>
            </div>
        </div>

        <!-- Next Scheduled Times -->
        <div class="grid grid-cols-3 gap-4">
            <div class="bg-blue-50 rounded-2xl p-4 shadow-sm border border-blue-100">
                <p class="text-xs text-blue-700 font-medium mb-2">{{ _('fetch_articles') or 'R√©cup√©ration' }}</p>
                <p class="text-lg font-bold text-blue-900">{{ stats.next_fetch.strftime('%H:%M') }}</p>
                <p class="text-xs text-blue-600">{{ stats.next_fetch.strftime('%d/%m') }}</p>
                <p class="text-xs text-blue-500 mt-2">Programm√©e: {{ stats.fetch_time }}</p>
            </div>
            <div class="bg-green-50 rounded-2xl p-4 shadow-sm border border-green-100">
                <p class="text-xs text-green-700 font-medium mb-2">{{ _('generate_summary') or 'R√©sum√©' }}</p>
                <p class="text-lg font-bold text-green-900">{{ stats.next_summary.strftime('%H:%M') }}</p>
                <p class="text-xs text-green-600">{{ stats.next_summary.strftime('%d/%m') }}</p>
                <p class="text-xs text-green-500 mt-2">Programm√©e: {{ stats.summary_time }}</p>
            </div>
            <div class="bg-purple-50 rounded-2xl p-4 shadow-sm border border-purple-100">
                <p class="text-xs text-purple-700 font-medium mb-2">{{ _('send_summary') or 'Envoi' }}</p>
                <p class="text-lg font-bold text-purple-900">{{ stats.next_send.strftime('%H:%M') }}</p>
                <p class="text-xs text-purple-600">{{ stats.next_send.strftime('%d/%m') }}</p>
                <p class="text-xs text-purple-500 mt-2">Programm√©e: {{ stats.send_time }}</p>
            </div>
        </div>

        <!-- Daily Statistics -->
        <div class="grid grid-cols-4 gap-4">
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}Articles aujourd'hui{% else %}Articles today{% endif %}</p>
                <p class="text-2xl font-bold text-gray-800">{{ stats.total_articles_today }}</p>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}Cette semaine{% else %}This week{% endif %}</p>
                <p class="text-2xl font-bold text-gray-800">{{ stats.total_articles_week }}</p>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}R√©sum√©s cr√©√©s{% else %}Summaries created{% endif %}</p>
                <p class="text-2xl font-bold text-gray-800">{{ stats.summaries_today }}</p>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                <p class="text-xs text-gray-500 mb-1">{% if current_lang == 'fr' %}R√©sum√©s envoy√©s{% else %}Summaries sent{% endif %}</p>
                <p class="text-2xl font-bold text-gray-800">{{ stats.summaries_sent_today }}</p>
            </div>
        </div>

        <!-- Delivery Channels -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex justify-between items-center mb-4">
                <h4 class="font-semibold text-gray-800">{% if current_lang == 'fr' %}Canaux de livraison{% else %}Delivery Channels{% endif %}</h4>
                <a href="{{ url_for('journalists.edit', id=journalist.id) }}" class="text-xs px-3 py-1 bg-primary-100 text-primary-600 rounded-lg hover:bg-primary-200 transition">
                    <i class="fas fa-edit mr-1"></i>{% if current_lang == 'fr' %}Configurer{% else %}Configure{% endif %}
                </a>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                {% for channel in delivery_channels %}
                <div class="p-4 bg-gradient-to-br {% if channel.channel_type == 'telegram' %}from-blue-50 to-blue-100 border border-blue-200{% elif channel.channel_type == 'email' %}from-orange-50 to-orange-100 border border-orange-200{% elif channel.channel_type == 'whatsapp' %}from-green-50 to-green-100 border border-green-200{% else %}from-gray-50 to-gray-100 border border-gray-200{% endif %} rounded-xl">
                    <div class="flex items-start justify-between">
                        <div>
                            <h5 class="font-semibold text-gray-800 mb-1">
                                {% if channel.channel_type == 'telegram' %}
                                    <i class="fab fa-telegram text-blue-600 mr-2"></i>Telegram
                                {% elif channel.channel_type == 'email' %}
                                    <i class="fas fa-envelope text-orange-600 mr-2"></i>Email
                                {% elif channel.channel_type == 'whatsapp' %}
                                    <i class="fab fa-whatsapp text-green-600 mr-2"></i>WhatsApp
                                {% endif %}
                            </h5>
                            <p class="text-sm text-gray-700">
                                {% if channel.channel_type == 'telegram' and channel.telegram_token %}
                                    ü§ñ Bot public
                                {% elif channel.channel_type == 'email' and channel.email_address %}
                                    üìß {{ channel.email_address }}
                                {% elif channel.channel_type == 'whatsapp' and channel.whatsapp_phone_number %}
                                    üì± {{ channel.whatsapp_phone_number }}
                                {% endif %}
                            </p>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs {% if channel.is_active %}bg-green-200 text-green-700{% else %}bg-gray-200 text-gray-600{% endif %}">
                            {{ _('active') if channel.is_active else _('inactive') }}
                        </span>
                    </div>
                </div>
                {% else %}
                <div class="col-span-3 text-center py-8 text-gray-500">
                    <i class="fas fa-exclamation-circle text-2xl mb-2 block"></i>
                    {% if current_lang == 'fr' %}Aucun canal de livraison configur√©{% else %}No delivery channels configured{% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Sources Statistics Table -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h4 class="font-semibold text-gray-800 mb-4">{% if current_lang == 'fr' %}Articles r√©cup√©r√©s par source{% else %}Articles per source{% endif %}</h4>
            <div class="overflow-x-auto text-sm">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-2 text-xs font-semibold text-gray-600">{{ _('source') }}</th>
                            <th class="text-center py-2 text-xs font-semibold text-gray-600">{{ _('type') }}</th>
                            <th class="text-center py-2 text-xs font-semibold text-gray-600">{% if current_lang == 'fr' %}Aujourd'hui{% else %}Today{% endif %}</th>
                            <th class="text-center py-2 text-xs font-semibold text-gray-600">{% if current_lang == 'fr' %}Cette semaine{% else %}This week{% endif %}</th>
                            <th class="text-center py-2 text-xs font-semibold text-gray-600">{{ _('status') }}</th>
                            <th class="text-left py-2 text-xs font-semibold text-gray-600">{% if current_lang == 'fr' %}Derni√®re r√©cup√©ration{% else %}Last fetch{% endif %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for source in stats.source_stats %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-2">
                                <a href="{{ source.url }}" target="_blank" class="text-primary-600 hover:underline truncate block max-w-xs" title="{{ source.url }}">
                                    {{ source.name or source.url[:30] }}
                                </a>
                            </td>
                            <td class="text-center py-2">
                                <span class="text-xs">
                                    {% if source.source_type == 'rss' %}
                                        <i class="fas fa-rss-square text-orange-500"></i>
                                    {% elif source.source_type == 'website' %}
                                        <i class="fas fa-globe text-blue-500"></i>
                                    {% elif source.source_type == 'twitter' %}
                                        <i class="fab fa-twitter text-blue-400"></i>
                                    {% elif source.source_type == 'youtube' %}
                                        <i class="fab fa-youtube text-red-500"></i>
                                    {% endif %}
                                </span>
                            </td>
                            <td class="text-center py-2 font-semibold">{{ source.articles_today }}</td>
                            <td class="text-center py-2 font-semibold">{{ source.articles_week }}</td>
                            <td class="text-center py-2">
                                <span class="px-2 py-1 text-xs rounded-full {% if source.is_active %}bg-green-100 text-green-600{% else %}bg-gray-100 text-gray-600{% endif %}">
                                    {{ _('active') if source.is_active else _('inactive') }}
                                </span>
                            </td>
                            <td class="py-2 text-xs text-gray-500">
                                {% if source.last_fetched_at %}
                                    {{ source.last_fetched_at.strftime('%d/%m %H:%M') }}
                                {% else %}
                                    <span class="text-gray-400">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="py-6 text-center text-gray-500">{{ _('no_sources') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex justify-between items-center mb-4">
                <h4 class="font-semibold text-gray-800">{{ _('sources') }} ({{ sources|length }})</h4>
                <button onclick="document.getElementById('addSourceModal').classList.remove('hidden')" class="px-4 py-2 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition text-sm">
                    <i class="fas fa-plus mr-1"></i> {{ _('add') }}
                </button>
            </div>
            
            <div class="space-y-3">
                {% for source in sources %}
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-white flex items-center justify-center">
                            <i class="fas fa-{% if source.source_type == 'rss' %}rss{% elif source.source_type == 'twitter' %}x-twitter{% elif source.source_type == 'youtube' %}youtube text-red-600{% elif source.source_type == 'website' %}globe{% else %}link{% endif %} text-gray-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">{{ source.name }}</p>
                            <p class="text-xs text-gray-500">{{ source.source_type|upper }} - {{ source.fetch_count }} {% if current_lang == 'fr' %}r√©cup√©rations{% else %}fetches{% endif %}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-1 rounded-full text-xs {% if source.is_active %}bg-green-100 text-green-600{% else %}bg-gray-200 text-gray-600{% endif %}">
                            {{ _('active') if source.is_active else _('inactive') }}
                        </span>
                        <form action="{{ url_for('journalists.delete_source', source_id=source.id) }}" method="POST" class="inline">
                            <button type="submit" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition" onclick="return confirm('{{ _('confirm_delete') }}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
                {% else %}
                <p class="text-center text-gray-500 py-8">{% if current_lang == 'fr' %}Aucune source configur√©e{% else %}No sources configured{% endif %}</p>
                {% endfor %}
            </div>
        </div>
        
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h4 class="font-semibold text-gray-800 mb-4">{% if current_lang == 'fr' %}Articles r√©cents{% else %}Recent Articles{% endif %} ({{ recent_articles|length }})</h4>
            <div class="space-y-3 max-h-96 overflow-y-auto">
                {% for article in recent_articles %}
                <div class="p-4 bg-gray-50 rounded-xl">
                    <h5 class="font-medium text-gray-800 mb-1">{{ article.title }}</h5>
                    <p class="text-sm text-gray-600 line-clamp-2">{{ truncate(article.content, 150) }}</p>
                    <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                        <span>{{ article.source.name if article.source else (_('article_source') if current_lang == 'en' else 'Source inconnue') }}</span>
                        <span>{{ time_ago(article.fetched_at) }}</span>
                    </div>
                </div>
                {% else %}
                <p class="text-center text-gray-500 py-8">{% if current_lang == 'fr' %}Aucun article r√©cup√©r√©{% else %}No articles fetched{% endif %}</p>
                {% endfor %}
            </div>
        </div>
        
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h4 class="font-semibold text-gray-800 mb-4">{% if current_lang == 'fr' %}R√©sum√©s r√©cents (texte){% else %}Recent Summaries (text){% endif %}</h4>
            <div class="space-y-4">
                {% for summary in recent_summaries %}
                <div class="p-4 bg-gray-50 rounded-xl">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs text-gray-500">{{ format_datetime(summary.created_at) }}</span>
                        <span class="px-2 py-1 bg-blue-100 text-blue-600 rounded-full text-xs">{{ summary.articles_count }} {{ _('articles') | lower }}</span>
                    </div>
                    <p class="text-sm text-gray-700 line-clamp-3">{{ truncate(summary.summary_text, 200) }}</p>
                    <p class="text-xs text-gray-500 mt-2">{% if current_lang == 'fr' %}Envoy√© √†{% else %}Sent to{% endif %} {{ summary.sent_count }} {{ _('subscribers') | lower }}</p>
                </div>
                {% else %}
                <p class="text-center text-gray-500 py-8">{% if current_lang == 'fr' %}Aucun r√©sum√© g√©n√©r√©{% else %}No summaries generated{% endif %}</p>
                {% endfor %}
            </div>
        </div>
        
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h4 class="font-semibold text-gray-800 mb-4">{% if current_lang == 'fr' %}R√©sum√©s r√©cents (audio){% else %}Recent Summaries (audio){% endif %}</h4>
            <div class="space-y-4">
                {% set audio_summaries = recent_summaries|selectattr('audio_url')|list %}
                {% for summary in audio_summaries %}
                <div class="p-4 bg-gray-50 rounded-xl">
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-xs text-gray-500">{{ format_datetime(summary.created_at) }}</span>
                        <span class="px-2 py-1 bg-purple-100 text-purple-600 rounded-full text-xs">
                            <i class="fas fa-volume-up mr-1"></i>
                            {% if current_lang == 'fr' %}Audio Eleven Labs{% else %}Eleven Labs Audio{% endif %}
                        </span>
                    </div>
                    <audio controls class="w-full h-8 mb-2">
                        <source src="{{ summary.audio_url }}" type="audio/mpeg">
                    </audio>
                    <p class="text-xs text-gray-500">{{ summary.articles_count }} {{ _('articles') | lower }} - {% if current_lang == 'fr' %}Envoy√© √†{% else %}Sent to{% endif %} {{ summary.sent_count }} {{ _('subscribers') | lower }}</p>
                </div>
                {% else %}
                <p class="text-center text-gray-500 py-8">
                    <i class="fas fa-volume-mute text-2xl text-gray-300 mb-2 block"></i>
                    {% if current_lang == 'fr' %}Aucun r√©sum√© audio g√©n√©r√©{% else %}No audio summaries generated{% endif %}
                </p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div id="addSourceModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-semibold">{{ _('add_source') }}</h3>
            <button onclick="document.getElementById('addSourceModal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form action="{{ url_for('journalists.add_source', id=journalist.id) }}" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if current_lang == 'fr' %}Type{% else %}Type{% endif %}</label>
                <select name="source_type" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500">
                    <option value="rss">{{ _('rss_feed') }}</option>
                    <option value="website">{{ _('website') }}</option>
                    <option value="twitter">Twitter/X</option>
                    <option value="youtube">YouTube</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if current_lang == 'fr' %}Nom{% else %}Name{% endif %}</label>
                <input type="text" name="name" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500" placeholder="{% if current_lang == 'fr' %}Nom de la source{% else %}Source name{% endif %}">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">URL</label>
                <input type="url" name="url" required class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500" placeholder="https://...">
            </div>
            <button type="submit" class="w-full py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition">
                {{ _('add') }}
            </button>
        </form>
    </div>
</div>

<div id="resultModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-lg">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold" id="resultTitle">{% if current_lang == 'fr' %}R√©sultat{% else %}Result{% endif %}</h3>
            <button onclick="document.getElementById('resultModal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="resultContent" class="text-gray-700"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function fetchSources() {
    fetch('{{ url_for("journalists.fetch_sources", id=journalist.id) }}', { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            document.getElementById('resultTitle').textContent = '{% if current_lang == "fr" %}R√©cup√©ration termin√©e{% else %}Fetch Complete{% endif %}';
            document.getElementById('resultContent').textContent = data.message;
            document.getElementById('resultModal').classList.remove('hidden');
        });
}

function generateSummaryText() {
    fetch('{{ url_for("journalists.generate_summary_text", id=journalist.id) }}', { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            document.getElementById('resultTitle').textContent = '{% if current_lang == "fr" %}R√©sum√© texte g√©n√©r√©{% else %}Text Summary Generated{% endif %}';
            document.getElementById('resultContent').innerHTML = '<p class="mb-2">' + data.message + '</p>' + 
                (data.summary ? '<div class="p-4 bg-gray-50 rounded-xl text-sm max-h-64 overflow-y-auto">' + data.summary + '</div>' : '');
            document.getElementById('resultModal').classList.remove('hidden');
        })
        .catch(e => {
            document.getElementById('resultTitle').textContent = '{% if current_lang == "fr" %}Erreur{% else %}Error{% endif %}';
            document.getElementById('resultContent').textContent = e.message;
            document.getElementById('resultModal').classList.remove('hidden');
        });
}

function generateSummaryAudio() {
    fetch('{{ url_for("journalists.generate_summary_audio", id=journalist.id) }}', { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            document.getElementById('resultTitle').textContent = '{% if current_lang == "fr" %}Audio g√©n√©r√©{% else %}Audio Generated{% endif %}';
            document.getElementById('resultContent').textContent = data.message;
            document.getElementById('resultModal').classList.remove('hidden');
            // Reload page after 2 seconds to see the new audio
            setTimeout(() => location.reload(), 2000);
        })
        .catch(e => {
            document.getElementById('resultTitle').textContent = '{% if current_lang == "fr" %}Erreur{% else %}Error{% endif %}';
            document.getElementById('resultContent').textContent = e.message;
            document.getElementById('resultModal').classList.remove('hidden');
        });
}

function generateSummary() {
    generateSummaryText();
}
</script>
{% endblock %}
