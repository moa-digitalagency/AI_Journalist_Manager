{% extends "admin/base.html" %}

{% block title %}{% if plan %}Modifier{% else %}Nouveau{% endif %} Forfait{% endblock %}
{% block header %}{% if plan %}Modifier {{ plan.name }}{% else %}Nouveau Forfait{% endif %}{% endblock %}
{% block subheader %}{% if plan %}Modifiez les paramètres du forfait{% else %}Créez un nouveau plan d'abonnement{% endif %}{% endblock %}

{% block content %}
<div class="max-w-2xl">
    <a href="{{ url_for('plans.index') }}" class="inline-flex items-center text-gray-600 hover:text-gray-800 mb-6">
        <i class="fas fa-arrow-left mr-2"></i>Retour à la liste
    </a>
    
    <form action="{{ url_for('plans.edit', id=plan.id) if plan else url_for('plans.create') }}" method="POST" class="space-y-6">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h3 class="font-semibold text-gray-800 mb-4">Informations générales</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nom du forfait *</label>
                    <input type="text" name="name" required value="{{ plan.name if plan else '' }}" 
                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500" 
                           placeholder="Ex: Premium, Basic...">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea name="description" rows="2" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500" 
                              placeholder="Description courte du forfait">{{ plan.description if plan else '' }}</textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Prix (€)</label>
                        <input type="number" name="price" step="0.01" value="{{ plan.price if plan else '0' }}" 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Durée (jours)</label>
                        <input type="number" name="duration_days" value="{{ plan.duration_days if plan else '30' }}" 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Messages max par jour (-1 = illimité)</label>
                    <input type="number" name="max_messages" value="{{ plan.max_messages_per_day if plan else '-1' }}" 
                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Fonctionnalités (une par ligne)</label>
                    <textarea name="features" rows="3" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500" 
                              placeholder="Résumés quotidiens&#10;Accès prioritaire&#10;Support dédié">{{ plan.features if plan else '' }}</textarea>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <h3 class="font-semibold text-gray-800 mb-4">Permissions</h3>
            
            <div class="space-y-4">
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" name="can_receive_summaries" {% if not plan or plan.can_receive_summaries %}checked{% endif %} 
                           class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <div>
                        <span class="font-medium text-gray-700">Recevoir les résumés</span>
                        <p class="text-xs text-gray-500">L'abonné recevra les résumés quotidiens</p>
                    </div>
                </label>
                
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" name="can_ask_questions" {% if not plan or plan.can_ask_questions %}checked{% endif %} 
                           class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <div>
                        <span class="font-medium text-gray-700">Poser des questions</span>
                        <p class="text-xs text-gray-500">L'abonné peut interagir avec le bot</p>
                    </div>
                </label>
                
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" name="can_receive_audio" {% if plan and plan.can_receive_audio %}checked{% endif %} 
                           class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <div>
                        <span class="font-medium text-gray-700">Résumés audio</span>
                        <p class="text-xs text-gray-500">L'abonné recevra les versions audio</p>
                    </div>
                </label>
                
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                    <input type="checkbox" name="is_trial" {% if plan and plan.is_trial %}checked{% endif %} 
                           class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                    <div>
                        <span class="font-medium text-gray-700">Forfait d'essai</span>
                        <p class="text-xs text-gray-500">Ce forfait est une période d'essai</p>
                    </div>
                </label>
            </div>
        </div>
        
        {% if plan %}
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <label class="flex items-center gap-3">
                <input type="checkbox" name="is_active" {% if plan.is_active %}checked{% endif %} 
                       class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                <span class="text-gray-700">Forfait actif</span>
            </label>
        </div>
        {% endif %}
        
        <button type="submit" class="w-full py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition font-medium">
            <i class="fas fa-save mr-2"></i>
            {% if plan %}Enregistrer{% else %}Créer le forfait{% endif %}
        </button>
    </form>
</div>
{% endblock %}
